---
- name: Coletar informações sobre serviços no Windows
  hosts: all
  gather_facts: no
  tasks:
    - name: Obter informações sobre serviços
      ansible.windows.win_service_info:
      register: service_info

    - name: Gerar relatório de serviços
      set_fact:
        service_report: "{{ service_report | default([]) + [item.name ~ ' ' ~ item.state] }}"
      loop: "{{ service_info.services }}"
      loop_control:
        label: "{{ item.name }}"

    - name: Exibir relatório de serviços
      debug:
        msg: "{{ service_report }}"

